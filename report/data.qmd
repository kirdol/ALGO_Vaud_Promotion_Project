# Overview of the questions of the survey

```{r loading the packages and data, output = FALSE, echo=FALSE}
source(here::here("scripts", "setup.R"))
data <- read.csv(here("data", "TMS_dataset_Vaud_20240314_FINAL.csv"), sep = ",")
```

Find below the list of questions that were asked during the survey. The original questionnaire that we received was in German. The questions were translated before conducting our analysis. The version shown below is a simplified version of the original questions. Fin the original German and English explanation in [Annex -@sec-data-description] and a better view at the type of data in [Annex -@sec-data-summary].

```{r dataframe with the questions, echo=FALSE}
questions <- data.frame(
  "Questions" = c("<b>F05: Your permanent residence<b/>",
                     "F05_01 your Continent",
                     "F05_02 your Land",
                     "F05_03 your Region",
                     "F05_04 your Subregion",
                  "<b>F12: Start of holidays in Switzerland:<b/>",
                  "<b>F13: End of holidays in Switzerland:<b/>",
                  "<b>F15: What time of year was in Switzerland during your holidays?<b/>",
                  "<b>F16: Type of holiday:<b/>",
                  "<b>F20: Number of overnight stays in Switzerland:<b/>",
                  "<b>F21: How long did your tour of Europe take in total (including Switzerland)?<b/>",
                  "<b>F30: Have you booked a package tour (a bundling of arrival and departure, accommodation and/or other tourist services on site)?<b/>",
                  "<b>F31: Who did you travel with?<b/>",
                     "F31_01 Alone",
                     "F31_02 With partner",
                     "F31_03 With friends / acquaintances",
                     "F31_04 With children",
                     "F31_05 With other family members",
                     "F31_06 In a group with unknown people",
                     "F31_07 With one dog(s)",
                     "F31_08 With one or more other pet(s)",
                  "<b>F32: Size of your group (number of people including yourself):<b/>",
                  "<b>F33: Size of your group (number of people including yourself but excluding people you don't know):<b/>",
                  "<b>F80: Please select a currency for your details:<b/>",
                  "<b>F80: Please select a currency for your details. - Others, namely:<b/>",
                  "<b>F81: How much did you spend in total during your stay in Switzerland?<b/>",
                      "F81_01 For your overnight stay",
                      "F81_02 For train, mountain railway, boat and other public transport (without arrival and departure)",
                       "F81_03 For food & drink (in the accommodation, on the road, out and about)",
                      "F81_04 For souvenirs, gifts, watches, jewellery",
                      "F81_05 For other shopping",
                      "F81_06 For other expenses",
                      "F81_07 In Total",
                  "<b>F82: How much did you spend in total during your stay in Switzerland? (if you took a package)<b/>",
                      "F82_01 Package",
                      "F82_02 For overnight stay",
                      "F82_03 For train, mountain railway, boat and other public transport (without arrival and departure)",
                      "F82_04 For food & drink (in the accommodation, on the road, out and about)",
                      "F82_05 For souvenirs, gifts, watches, jewellery",
                      "F82_06 For other shopping",
                      "F82_07 For other expenses",
                      "F82_08 Total expenditure excluding expenditure on package holidays",
                  "<b>F83: Does the package include travel to and from the resort?<b/>",
                  "<b>F85: You have therefore spent a total of [amount] (excluding package costs) during your stay in Switzerland. Is that right?<b/>",
                  "<b>F105: Your resort where you were staying when your email address was collected for this survey:<b/>",
                      "F105_Code City",
                      "F105_OrgCode Tourism office region",
                  "<b>F125: Your accomodation<b/>",
                     "F125 Type of accomodation",
                     "F125_a11 Other type",
                  "<b>F130: Star category of the hotel / spa house visited<b/>",
                     "F130 Number of stars",
                     "F130 Other classification",
                  "<b>F135: Number of nights in [Answer from F105]:<b/>"),
  "Types" = c("",
              "character: Europe, Asia, ...",
              "character: Switzerland, France, ...",
              "character: Île-de-France, California, ...",
              "character: Manchester, Andalucìa, ...",
              "date: 07.11.23, 28.02.22, ...",
              "date: 02.12.23, 29.03.22, ...",
              "character: Winter, Summer, ...",
              "multiple choice: <br>Holidays with only one overnight stay in Switzerland, Round trip only within Switzerland (several overnight locations in Switzerland),<br>Round trip through Europe: several places to stay in Switzerland, <br>Round trip through Europe: only one overnight stay in Switzerland, ...",
              "integer: 2, 8, ...",
              "integer: 2, 8, ...",
              "boolean: YES, NO",
              "",
              "boolean: YES, NO",
              "boolean: YES, NO",
              "boolean: YES, NO",
              "boolean: YES, NO",
              "boolean: YES, NO",
              "boolean: YES, NO",
              "boolean: YES, NO",
              "boolean: YES, NO",
              "integer: 2, 8, ...",
              "integer: 2, 8, ...",
              "multiple choice: CHF, EUR, ...",
              "character: JPY, BDT, ...",
              "",
              "integer: 50, 1000, ...",
              "iInteger: 50, 1000, ...",
              "nteger: 50, 1000, ...",
              "integer: 50, 1000, ...",
              "integer: 50, 1000, ...",
              "integer: 50, 1000, ...",
              "integer: 50, 1000, ...",
              "",
              "integer: 50, 1000, ...",
              "integer: 50, 1000, ...",
              "integer: 50, 1000, ...",
              "integer: 50, 1000, ...",
              "integer: 50, 1000, ...",
              "integer: 50, 1000, ...",
              "integer: 50, 1000, ...",
              "integer: 50, 1000, ...",
              "boolean: YES, NO",
              "boolean: YES, NO",
              "",
              "character: Lausanne, Montreux, ...",
              "character: Morges Région, Montreux Riviera, ...",
              "",
              "multiple choice: Hotel, Camping, ...",
              "character: family, friends housse, ...",
              "",
              "integer: 1, 5, ...",
              "character: not aware, Chyba 3, ...",
              "integer: 2, 8, ..."))
```

```{r creation of the table, echo=FALSE}
questions %>%
  kable("html", escape = FALSE) %>%
  kable_styling(bootstrap_options = c("striped",
                                      "hover",
                                      "condensed",
                                      "responsive")) %>%
  add_indent(positions = c(2:5,
                           14:21,
                           27:33,
                           35:42,
                           46:47,
                           49:50,
                           52:53))
```

## Analysis of the NAs
Now that we have a better understanding of the questions asked during the survey, let's look at the missing values of our dataset. Find below the visualization of the entire dataset. The gray cells represent the missing values.

```{r Vis dat plot of all the data, echo=FALSE}
# Function to replace empty strings with NA in character columns
convert_blanks_to_NA <- function(x) {
  x[x == ""] <- NA
  return(x)}

# Apply the function to character columns
data[sapply(data, is.character)] <-
  lapply(data[sapply(data, is.character)], convert_blanks_to_NA)

# Generate the plot
plot <- vis_dat(data) +
  theme(legend.position = "bottom")
plot
```

Let's now have a closer look at the column with missing values. We will order the columns by the percentage of missing values.

```{r Vis_miss Missing values, echo=FALSE}
# Filter columns with missing values
missing_percentages <- sapply(data, function(x) sum(is.na(x)) / length(x))
columns_with_missing <- which(missing_percentages > 0)
data_with_missing <- data[, columns_with_missing]

# Order columns by the percentage of missing values
ordered_indices <- order(missing_percentages[columns_with_missing], decreasing = TRUE)
data_ordered <- data_with_missing[, ordered_indices]

# plot
vis_miss(data_ordered)
```


It's evident that several columns exhibit a high rate of missing data. This often occurs when respondents are required to enter a custom answer because the provided multiple-choice options do not include an appropriate response. The F82_0x columns relate to the expenses incurred by tourists who opted for a package, while the F81_0x columns pertain to expenses of tourists who did not purchase a package. These column are thus complementary (`r round(sum(is.na(data$F82_01)) / nrow(data) * 100)`% + `r round(sum(is.na(data$F81_01)) / nrow(data) * 100)`% = `r (sum(is.na(data$F82_01)) / nrow(data) * 100) + (sum(is.na(data$F81_01)) / nrow(data) * 100)`%). This needs to be kept in mind when interpreting the results of our analysis.